# MIDI简谱解析器

将自定义ASCII简谱（单声部首调制）转成MIDI，并尝试播放。

## 特性

- 支持1-7简谱记号、休止符
- 支持升降号、八度、时值、附点、连音线
- 支持和弦标记（如C、Cm、G7等）
- 多种和弦演奏模式：柱式和弦、分解和弦、吉他扫弦、节奏型分解和弦
- 支持节拍器

## 使用方法

```
python main.py <score.txt> [output.mid]
```

示例:
```
python main.py example_chord_patterns.txt
```

### 简谱文件格式

```
# 元数据行（使用#开头）
#KEY=C        # 调号：C、G、D、A、E、B、F#、Db、Ab、Eb、Bb、F
#TEMPO=120    # 速度(BPM)
#TIME=4/4     # 拍号
#UNIT=q       # 基本单位音符（q=四分音符）
#CHORD_PATTERN=block  # 和弦模式：block(柱式)、arpeggio(分解)、guitar(吉他扫弦)、rhythmic(节奏型)

; 注释行（使用;开头）

1 2 3 4 | 5 6 7 1' |  # 音符行，以|或||结尾表示小节线
C 1 2 3 | G7 5 6 7 |  # 可以在音符前加和弦标记
```

### 音符格式

- 数字：`1-7` 表示音阶
- 升降号：`#`、`b`，例如：`#1`、`b7`
- 八度：`'` 表示高八度，`,` 表示低八度，可叠加，例如：`1'`、`5,`
- 时值：
  - `w` = 全音符，`h` = 半音符，`q` = 四分音符
  - `e` = 八分音符，`s` = 十六分音符，`t` = 三十二分音符
  - `/n` = 1/n音符，例如：`/8` = 八分音符
- 附点：`.` 延长一半时值，`..` 延长四分之三，例如：`5.`
- 连音线：`-` 表示连接下一个同音，例如：`1-`
- 休止符：`0` 或 `R`

### 和弦标记

支持多种和弦类型：
- 大三和弦: `C`, `F#`, `Bb`
- 小三和弦: `Cm`, `F#m`, `Bbm`
- 增三和弦: `Caug`, `F#+`, `Bbaug`
- 减三和弦: `Cdim`, `F#o`, `Bbo`
- 挂四和弦: `Csus4`, `F#sus4`
- 挂二和弦: `Csus2`, `F#sus2`
- 属七和弦: `C7`, `F#7`, `Bb7`
- 大七和弦: `CM7`, `Cmaj7`, `F#M7`, `BbM7`
- 小七和弦: `Cm7`, `F#m7`, `Bbm7`
- 半减七和弦: `Cm7b5`, `F#m7b5`
- 减七和弦: `Cdim7`, `Co7`, `F#o7`
- 无和弦: `O`（此时不演奏和弦）

### 和弦模式

可以在文件的元数据部分设置和弦的演奏模式：

```
#CHORD_PATTERN=模式名
```

支持的模式：
- `block`：柱式和弦 - 所有音符同时演奏（默认）
- `arpeggio`：分解和弦 - 音符一个接一个演奏，均匀分布在和弦持续时间内
- `guitar`：吉他扫弦 - 快速顺序演奏，从低音到高音
- `rhythmic`：节奏型分解和弦 - 根据乐曲拍号创建符合节奏的分解和弦模式

不同模式的特点：
- `arpeggio`：每个和弦音符持续相等的时间，一个结束后下一个立即开始
- `rhythmic`：按照乐曲的拍号自动创建符合节奏的分解模式，例如：
  - 4/4拍：形成1拍1拍1拍1拍的节奏型
  - 3/4拍：形成1拍1拍1拍的节奏型
  - 6/8拍：形成6个八分音符的节奏型
  - 2/4拍：形成1拍1拍的节奏型

可以在乐曲中间随时更换和弦模式：

```
#CHORD_PATTERN=block
C 1 2 3 4 | G 5 6 7 1' ||
#CHORD_PATTERN=rhythmic
C 1 2 3 4 | G 5 6 7 1' ||
```

## 示例

- `example_chord_patterns.txt`：展示基本的和弦模式
- `arpeggio_examples.txt`：展示不同拍号下的分解和弦模式

## 依赖

- Python 3.6+
- mido
- python-rtmidi（可选，用于实时播放） 